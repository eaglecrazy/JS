!function(t){var e={};function s(a){if(e[a])return e[a].exports;var i=e[a]={i:a,l:!1,exports:{}};return t[a].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=t,s.c=e,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(a,i,function(e){return t[e]}.bind(null,i));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);new Vue({el:"#app",data:{isVisibleGoodsList:!0,goods:[],filteredGoods:[],isVisibleCart:!1,cart:[],isVisibleFetchError:!1,chatVisibility:!1},methods:{buttonIndexClick(){this.isVisibleGoodsList=!0,this.isVisibleCart=!1},buttonCartClick(){this.fetchCart(),this.isVisibleGoodsList=!1,this.isVisibleCart=!0},makeGetRequest:t=>new Promise((e,s)=>{let a;a=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP"),a.onreadystatechange=function(){4===a.readyState&&(200===a.status?("[]"==a.responseText&&e([]),e(JSON.parse(a.responseText))):s("Error"))},a.open("GET",t),a.send()}),fetchCart(){this.makeGetRequest("/cart").then(t=>{this.newCart=t.map(t=>new class{constructor(t){this.title=t.title,this.title||(this.title=t.product_name),this.price=t.price,this.quantity=1}}(t.title,t.price,t.quantity)),this.cart=t}).catch(t=>{console.log("fetchCart error")})},fetchGoods(){this.makeGetRequest("/catalog").then(t=>{this.goods=t.map(t=>new class{constructor(t="Без имени",e=0){this.title=t,this.price=e}}(t.product_name,t.price)),this.goods.forEach(t=>{this.filteredGoods.push(t)})}).catch(t=>{console.log("fetchGoods error"),this.isVisibleFetchError=!0})},makePostRequest:(t,e)=>new Promise((s,a)=>{let i;i=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP"),i.onreadystatechange=function(){4===i.readyState&&(200===i.status?s():a("Error"))},i.open("POST",t),i.setRequestHeader("Content-Type","application/json","charset=UTF-8"),i.send(JSON.stringify(e))}),addItemToCart(t){var e=!1;if(this.cart.find(s=>{if(s.title===t.title)return s.quantity++,e=s}),e)return void this.changeItemInCart(e);this.makePostRequest("/cart-add",t).then(()=>{console.log("FRONT POST OK"),this.fetchCart()}).catch(t=>{console.log("FRONT POST ERROR")})},removeItemFromCart(t){this.makePostRequest("/cart-remove",t).then(()=>{console.log("FRONT POST OK"),this.fetchCart()}).catch(t=>{console.log("FRONT POST ERROR")})},changeItemInCart(t){this.makePostRequest("/cart-change",t).then(()=>{console.log("FRONT POST OK"),this.fetchCart()}).catch(t=>{console.log("FRONT POST ERROR")})}},mounted(){this.fetchGoods(),this.fetchCart()},components:{goodsList:{name:"goods-list",props:["goods","filteredGoods","visible","fetch-error"],template:'<div class="goods-list" v-if="visible">\n                    <goods-item v-for="good in filteredGoods" :good="good" :key="good.title" @add-item-to-cart="addItemToCart(good)"></goods-item>\n                    <div class="goods-list-info" v-if="goodsListEmpty">Товаров не найдено.</div>\n                </div>',computed:{goodsListEmpty(){return!this.fetchError&&0===this.filteredGoods.length}},components:{goodsItem:{name:"goods-item",props:["good"],template:'<div class="goods-item">\n            <h3 class="goods-item-heading">{{ good.title }}</h3>\n            <img class="item-image" src="img/game.jpg" width="250" height="156" v-bind:alt="good.title">\n            <p class="goods-item-text">Цена: {{ good.price }} рублей</p>\n            <button class="button" v-bind:id="good.title" @click="addItemToCart">Добавить в корзину</button>\n        </div>',methods:{addItemToCart(){this.$emit("add-item-to-cart",this.item)},changeItemInCart(){this.$emit("change-item-in-cart",this.item)}}}},methods:{addItemToCart(t){this.$emit("add-item-to-cart",t)}}},search:{template:'<form class="searchForm">\n        <input type="text" class="searchInput form-input" placeholder="" v-model="searchLine" >\n        <button class="button searchButton" @click="buttonSearchClick">Поиск</button>\n     </form>',props:["goods","filteredGoods"],data:()=>({searchLine:""}),methods:{buttonSearchClick(t){t.preventDefault();const e=new RegExp(this.searchLine,"i");this.filteredGoods.splice(0,this.filteredGoods.length),this.goods.forEach(t=>{e.test(t.title)&&this.filteredGoods.push(t)})}}},cart:{name:"cart",props:["visible","cart"],template:'<div class="cart-wrapper" v-if="visible">\n            <div class="cart-items">\n                <cartItem v-for="cartItem in cart" :cartItem="cartItem" :key="cartItem.title" @remove-item-from-cart="removeItemFromCart(cartItem)" @change-item-in-cart="changeItemInCart(cartItem)"></cartItem>\n            </div>\n            <div class="cart-info">\n                <span class="cart-info-text">Всего товаров:</span><span class="cart-info-text cart-info-quantity">{{ cartTotalQuantity }} шт.</span>\n                <span class="cart-info-text">Общая стоимость:</span><span class="cart-info-text cart-info-price">{{ cartTotalPrice }} руб.</span>\n                <button class="button cart-issue-button">Перейти к оформлению</button>\n            </div>\n        </div>',computed:{cartTotalPrice(){return this.cart.reduce((t,e)=>(e.price&&(t+=e.price*e.quantity),t),0)},cartTotalQuantity(){return this.cart.reduce((t,e)=>(e.quantity&&(t+=parseInt(e.quantity)),t),0)}},components:{cartItem:{props:["cartItem"],template:'<div class="cart-item">\n                    <img class="item-image" src="img/game.jpg" width="250" height="156" v-bind:alt="cartItem.title">\n                    <div class="cart-item-info">\n                        <h3 class="goods-item-heading">{{ cartItem.title }}</h3>\n                        <p class="goods-item-text cart-item-price">Цена: {{ cartItem.price }} рублей.</p>\n                        <input @change="changeItemInCart(cartItem)" type="number" min="1" max="99" class="cart-item-quantity" v-model="cartItem.quantity">\n                    </div>\n                    <svg class="cart-item-cross" viewBox="0 0 52 52" @click="cartCrossClick(cartItem)">\n                        <path d="M26,0C11.664,0,0,11.663,0,26s11.664,26,26,26s26-11.663,26-26S40.336,0,26,0z M26,50C12.767,50,2,39.233,2,26S12.767,2,26,2s24,10.767,24,24S39.233,50,26,50z" />\n                        <path d="M35.707,16.293c-0.391-0.391-1.023-0.391-1.414,0L26,24.586l-8.293-8.293c-0.391-0.391-1.023-0.391-1.414,0s-0.391,1.023,0,1.414L24.586,26l-8.293,8.293c-0.391,0.391-0.391,1.023,0,1.414C16.488,35.902,16.744,36,17,36s0.512-0.098,0.707-0.293L26,27.414l8.293,8.293C34.488,35.902,34.744,36,35,36s0.512-0.098,0.707-0.293c0.391-0.391,0.391-1.023,0-1.414L27.414,26l8.293-8.293C36.098,17.316,36.098,16.684,35.707,16.293z" /></svg>\n                </div>',methods:{cartCrossClick(t){this.$emit("remove-item-from-cart",t)},changeItemInCart(t){this.$emit("change-item-in-cart",t)}}}},methods:{removeItemFromCart(t){this.$emit("remove-item-from-cart",t)},changeItemInCart(t){this.$emit("change-item-in-cart",t)}}},fetchError:{name:"fetch-error",props:["visible"],template:'<div v-if="visible" class="goods-list-info">Не удалось получить список товаров с сервера.</div>'},chat:{name:"chat",props:["visible"],template:'<div class="chatWrapper" v-bind:class="{ \'chatCollapsed\': isCollapsed }">\n                    <chatHeader></chatHeader>\n                    <chatContent></chatContent>\n                    <chatForm></chatForm>\n                </div>',components:{chatHeader:{name:"chatHeader",template:'<div class="chatHeader">\n            <svg class="chatCross" viewBox="0 0 52 52"><path d="M26,0C11.664,0,0,11.663,0,26s11.664,26,26,26s26-11.663,26-26S40.336,0,26,0z M26,50C12.767,50,2,39.233,2,26S12.767,2,26,2s24,10.767,24,24S39.233,50,26,50z"></path><path d="M35.707,16.293c-0.391-0.391-1.023-0.391-1.414,0L26,24.586l-8.293-8.293c-0.391-0.391-1.023-0.391-1.414,0s-0.391,1.023,0,1.414L24.586,26l-8.293,8.293c-0.391,0.391-0.391,1.023,0,1.414C16.488,35.902,16.744,36,17,36s0.512-0.098,0.707-0.293L26,27.414l8.293,8.293C34.488,35.902,34.744,36,35,36s0.512-0.098,0.707-0.293c0.391-0.391,0.391-1.023,0-1.414L27.414,26l8.293-8.293C36.098,17.316,36.098,16.684,35.707,16.293z"></path></svg>\n            <svg class="chatAvatar" viewBox="0 0 53 53"><path style="fill:#E7ECED;" d="M18.613,41.552l-7.907,4.313c-0.464,0.253-0.881,0.564-1.269,0.903C14.047,50.655,19.998,53,26.5,53c6.454,0,12.367-2.31,16.964-6.144c-0.424-0.358-0.884-0.68-1.394-0.934l-8.467-4.233c-1.094-0.547-1.785-1.665-1.785-2.888v-3.322c0.238-0.271,0.51-0.619,0.801-1.03c1.154-1.63,2.027-3.423,2.632-5.304c1.086-0.335,1.886-1.338,1.886-2.53v-3.546c0-0.78-0.347-1.477-0.886-1.965v-5.126c0,0,1.053-7.977-9.75-7.977s-9.75,7.977-9.75,7.977v5.126c-0.54,0.488-0.886,1.185-0.886,1.965v3.546c0,0.934,0.491,1.756,1.226,2.231c0.886,3.857,3.206,6.633,3.206,6.633v3.24C20.296,39.899,19.65,40.986,18.613,41.552z"></path><path style="fill:#556080;" d="M26.953,0.004C12.32-0.246,0.254,11.414,0.004,26.047C-0.138,34.344,3.56,41.801,9.448,46.76c0.385-0.336,0.798-0.644,1.257-0.894l7.907-4.313c1.037-0.566,1.683-1.653,1.683-2.835v-3.24c0,0-2.321-2.776-3.206-6.633c-0.734-0.475-1.226-1.296-1.226-2.231v-3.546c0-0.78,0.347-1.477,0.886-1.965v-5.126c0,0-1.053-7.977,9.75-7.977s9.75,7.977,9.75,7.977v5.126c0.54,0.488,0.886,1.185,0.886,1.965v3.546c0,1.192-0.8,2.195-1.886,2.53c-0.605,1.881-1.478,3.674-2.632,5.304c-0.291,0.411-0.563,0.759-0.801,1.03V38.8c0,1.223,0.691,2.342,1.785,2.888l8.467,4.233c0.508,0.254,0.967,0.575,1.39,0.932c5.71-4.762,9.399-11.882,9.536-19.9C53.246,12.32,41.587,0.254,26.953,0.004z"></path></svg>\n            <span class="chatName">Саймон Б.</span>\n            <span class="chatInfo">Напишите нам, мы онлайн!</span>\n            <span class="chatWorker">Кoнсультант</span>\n\t   </div>'},chatContent:{name:"chatContent",template:'<div class="chatContent">\n\t\t<div class="messageWrap">\n\t\t\t<div class="chatMessage chatMessageAdmin">Хорошо.</div>\n\t\t\t<time  class="chatTime">18:02</time>\n\t\t</div>\n\t\t<div class="messageWrap">\n\t\t\t<time class="chatTime">18:02</time>\n\t\t\t<div class="chatMessage chatMessageUser">Не можете.</div>\n\t\t</div>\n\t\t<div class="messageWrap">\n\t\t\t<div class="chatMessage chatMessageAdmin">Здравствуйте! Я могу вам чем-то помочь?</div>\n\t\t\t<time class="chatTime">18:02</time>\n\t\t</div>\n\t</div>'},chatForm:{name:"chatForm",template:'<form action="#" method="post" class="chatForm">\n            <svg class="chatClip" viewBox="0 0 30.34 30.34"><path d="M22.562,12.491c0,0,1.227-0.933,0.293-1.866c-0.934-0.933-1.842,0.271-1.842,0.271l-9.389,9.391c0,0-2.199,2.838-3.871,1.122c-1.67-1.718,1.121-3.872,1.121-3.872l12.311-12.31c0,0,2.873-3.165,5.574-0.466c2.697,2.7-0.477,5.579-0.477,5.579L12.449,24.173c0,0-4.426,5.113-8.523,1.015s1.066-8.474,1.066-8.474L15.494,6.209c0,0,1.176-0.982,0.295-1.866c-0.885-0.883-1.865,0.295-1.865,0.295L1.873,16.689c0,0-4.549,4.989,0.531,10.068c5.08,5.082,10.072,0.533,10.072,0.533l16.563-16.565c0,0,3.314-3.655-0.637-7.608s-7.607-0.639-7.607-0.639L6.543,16.728c0,0-3.65,2.969-0.338,6.279c3.312,3.314,6.227-0.39,6.227-0.39L22.562,12.491z"></path></svg>\n            <textarea name="" id="" class="chatInput" placeholder="Введите сообщение и нажимте Enter"></textarea>\n\t   </form>'}},computed:{isCollapsed(){return!this.visible}}}}})}]);